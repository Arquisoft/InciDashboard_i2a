<!DOCTYPE html>
<html lan="en">
	<head th:replace="fragments/head"/>
	<body>
		<nav th:replace="fragments/nav" />
		<div class="container">
			<h2>Modify incident - <span th:text="${incident.name}"></span></h2>
			<div class="card">
				<div class="card-body">
					<div id="mapa" style="width:100%;height:400px"></div>
				</div>
			</div>
			<script th:inline="javascript">
				/*<![CDATA[*/
					function initMap(){
						var initialLatLng = {lat: 40.6753526, lng:-6.6971668};
						var map = new google.maps.Map(document.getElementById("mapa"), {
							zoom: 5,  
							center: initialLatLng          
					    });	
						
						var incident = [[${incident}]];
						var inciLocation = {
								lat: parseFloat(incident.location.lat),
								lng: parseFloat(incident.location.lng)
						}
						var marker = new google.maps.Marker({
							position: inciLocation,
							title: incident.name,
							draggable: true,
							map: map
						});
						
						marker.addListener("dragend", function(event){
							var location = event.latLng.lat() + "," + event.latLng.lng();
							document.getElementById("location").value = location;
						});						
					}
				/*]]>*/
			</script>
			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBAr9ogXGdZ9_qScXx3Pd8Rg0Kv5TuSV_U&callback=initMap" async defer></script>
			<div class="panel panel-default">	
				<form class="form-horizontal" method="post" th:action="${'/incident/edit/' + incident.id}" th:object="${incident}">
					<div class="form-group">
						<label class="control-label col-sm-2" for="inciState">Incident state:</label>
						<div class="col-sm-10">
							<select id="state" class="form-control" name="inciState">
								<option th:each="inciState : ${statesList}" th:value="${inciState}"
									th:text="${inciState}"> Estado
								</option>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="latlng">Location:</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" name="latlng" id="location" 
								placeholder="Modify location by dragging marker in map" required="false"/>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-sm-2" for="comment">Comment: </label>
						<div class="col-sm-10">
							<input type="text" class="form-control" name="comment"
								placeholder="Introduce comment for the incident" required="true"/>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button type="submit" class="btn btn-primary">Modify</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<footer th:replace="fragments/footer"/>
	</body>
</html>